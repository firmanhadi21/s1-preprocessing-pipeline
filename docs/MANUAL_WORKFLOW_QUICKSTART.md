# Manual Period Workflow - Quick Start

## What Is This?

A **manual workflow** where you:
1. Download files yourself from ASF and organize by period
2. Run a script to preprocess and mosaic each period
3. Stack all periods into final 31-band GeoTIFF

**Best for:** When you want to manually select which scenes to download for each period.

## Setup (One-Time)

### Step 1: Create Folder Structure

```bash
python setup_manual_period_folders.py
```

This creates:
```
downloads_p1/      # Period 1 (Jan 1-12)
downloads_p2/      # Period 2 (Jan 13-24)
...
downloads_p31/     # Period 31 (Dec 27-31)
mosaics/           # Will contain mosaic_p1.tif, mosaic_p2.tif, etc.
final_stack/       # Will contain final 31-band stack
```

Each `downloads_pX/` folder has a README with the period date range.

### Step 2: Download Files Manually

**For each period:**

1. Go to [ASF Data Search](https://search.asf.alaska.edu/)
2. Set the period's date range (see README.txt in each folder)
3. Draw your region of interest
4. Select "Sentinel-1" ‚Üí "GRD_HD"
5. Search and download
6. Place ZIP files in the corresponding `downloads_pX/` folder

**Example for Period 1 (Jan 1-12, 2024):**
- Date range: 2024-01-01 to 2024-01-12
- Download scenes covering your AOI
- Place in `downloads_p1/`

**Repeat for all 31 periods** (or just the periods you need).

## Processing

### Option A: Process One Period at a Time

```bash
# Process Period 1 (preprocess + mosaic)
python s1_manual_period_workflow.py --period 1 --run-all

# Process Period 2
python s1_manual_period_workflow.py --period 2 --run-all

# ... continue for all periods

# Finally, stack all mosaics
python s1_manual_period_workflow.py --stack --year 2024
```

### Option B: Process All Periods Together

```bash
# After downloading files for all periods:

# 1. Preprocess all periods
python s1_manual_period_workflow.py --preprocess-all

# 2. Mosaic all periods
python s1_manual_period_workflow.py --mosaic-all

# 3. Stack all mosaics
python s1_manual_period_workflow.py --stack --year 2024
```

### Option C: Full Automated Processing

```bash
# After downloading all files, run everything in one command:
python s1_manual_period_workflow.py --run-all --year 2024
```

## Outputs

After processing, you'll have:

```
mosaics/
‚îú‚îÄ‚îÄ mosaic_p1.tif     # Period 1 mosaic (seamless, VH in dB)
‚îú‚îÄ‚îÄ mosaic_p2.tif     # Period 2 mosaic
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ mosaic_p31.tif    # Period 31 mosaic

final_stack/
‚îî‚îÄ‚îÄ S1_VH_stack_2024_31bands.tif  ‚Üê Use this for training!
```

## Integration with Training

```python
# In config.py
PREDICTION_GEOTIFF = 'final_stack/S1_VH_stack_2024_31bands.tif'
```

Then:
```bash
python train.py
python predict.py --period 15
```

## Common Commands

```bash
# Setup folders
python setup_manual_period_folders.py

# Process single period
python s1_manual_period_workflow.py --period 15 --run-all

# Just preprocess Period 15
python s1_manual_period_workflow.py --period 15 --preprocess

# Just mosaic Period 15
python s1_manual_period_workflow.py --period 15 --mosaic

# Process all periods
python s1_manual_period_workflow.py --run-all --year 2024

# Just stack existing mosaics
python s1_manual_period_workflow.py --stack --year 2024
```

## Key Features

‚úÖ **Manual scene selection** - Choose exactly which scenes to download
‚úÖ **Period organization** - Downloads organized by 12-day period
‚úÖ **Seamless mosaicking** - Automatically ignores NULL values
‚úÖ **Resumable** - Skips already-processed files
‚úÖ **Flexible** - Process periods individually or all together

## Folder Structure Details

```
your_workspace/
‚îú‚îÄ‚îÄ downloads_p1/               # Your manual downloads
‚îÇ   ‚îú‚îÄ‚îÄ S1A_IW_GRDH_*.zip
‚îÇ   ‚îú‚îÄ‚îÄ S1B_IW_GRDH_*.zip
‚îÇ   ‚îî‚îÄ‚îÄ README.txt              # Period info
‚îú‚îÄ‚îÄ preprocessed_p1/            # Auto-generated by script
‚îÇ   ‚îú‚îÄ‚îÄ *_processed.dim
‚îÇ   ‚îî‚îÄ‚îÄ *_processed.data/
‚îú‚îÄ‚îÄ mosaics/                    # Auto-generated
‚îÇ   ‚îú‚îÄ‚îÄ mosaic_p1.tif
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ final_stack/                # Auto-generated
    ‚îî‚îÄ‚îÄ S1_VH_stack_2024_31bands.tif
```

## Mosaicking Details

The workflow creates **seamless mosaics** by:
- Extracting VH band from preprocessed files
- Converting to GeoTIFF
- Merging with `rasterio.merge()`
- **Ignoring NULL/nodata values** automatically
- Using "first valid pixel" for overlaps
- Output: Compressed, tiled GeoTIFF

**No seam lines, no manual editing needed!**

## Tips

### Download Strategy

**For small areas (10√ó10 km):**
- 1-3 scenes per period
- Fast processing

**For large areas (100√ó100 km):**
- 10-20 scenes per period
- More mosaicking needed

### Period Selection

**Don't need all periods?**
- Download only growing season (e.g., periods 5-25)
- Process those periods
- Stack will have gaps for missing periods (filled with nodata)

### Disk Space

- Downloads: ~1 GB per scene
- Preprocessed: ~2 GB per scene
- Mosaics: ~0.5-2 GB per period
- Final stack: ~2-10 GB

**Cleanup after:**
```bash
# Keep only mosaics and final stack
rm -rf downloads_p*
rm -rf preprocessed_p*
```

## Troubleshooting

### "No ZIP files found"
‚Üí Download files from ASF and place in `downloads_pX/` folder

### "Processing failed"
‚Üí Check SNAP GPT path: `--snap-gpt-path /path/to/snap/bin/gpt`

### "Mosaic already exists"
‚Üí Delete and recreate: `rm mosaics/mosaic_pX.tif`

## Full Documentation

For complete details, see:
- **`MANUAL_PERIOD_WORKFLOW_GUIDE.md`** - Complete guide with all options
- **`12DAY_PERIOD_SYSTEM.md`** - Period date calendar
- **`AUTOMATED_PIPELINE_GUIDE.md`** - SNAP preprocessing details

## Example Complete Workflow

```bash
# 1. Setup
python setup_manual_period_folders.py

# 2. Download manually from ASF
#    Place in downloads_p1/, downloads_p2/, etc.

# 3. Process
python s1_manual_period_workflow.py --run-all --year 2024

# 4. Verify
ls -lh mosaics/
ls -lh final_stack/

# 5. Train
nano config.py  # Update PREDICTION_GEOTIFF
python train.py

# 6. Predict
python predict.py --period 15
```

## Comparison: Manual vs Automated

| Aspect | Manual Workflow | Automated Pipeline |
|--------|----------------|-------------------|
| Download | Manual from ASF | Automatic via script |
| Scene selection | Full control | Uses all scenes |
| Setup time | 2-4 hours | 5 minutes |
| Processing | Semi-automatic | Fully automatic |
| Best for | Specific scenes | Full automation |

**Use manual workflow when:**
- ‚úÖ You want to pick specific scenes
- ‚úÖ You're processing select periods
- ‚úÖ You already have downloads
- ‚úÖ You want maximum control

**Use automated pipeline when:**
- ‚úÖ You want zero manual work
- ‚úÖ You're processing all 31 periods
- ‚úÖ You don't need scene selection

## Ready to Start!

```bash
# Quick start:
python setup_manual_period_folders.py
# Then download files and run:
python s1_manual_period_workflow.py --run-all --year 2024
```

Happy mapping! üåæüõ∞Ô∏è
